<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Inventory Management System</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background:linear-gradient(135deg,rgb(220, 223, 236) 0%,rgb(42, 51, 183) 100%);
                min-height: 100vh;
                padding: 20px;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
                background: white;
                border-radius: 15px;
                box-shadow: 0 20px 40px rgba(0,0,0,0.1);
                overflow: hidden;
            }

            .header {
                background: linear-gradient(135deg, rgb(193, 195, 205) 0%,rgb(42, 51, 183) 100%);
                color: white;
                padding: 30px;
                text-align: center;
            }
            
            .header h1 {
                font-size: 2.5em;
                margin-bottom: 10px;
            }

            .nav-tab {
                flex: 1;
                padding: 15px 20px;
                background: none;
                border: none;
                cursor: pointer;
                font-size: 16px;
                transition: all 0.3s;
            }

            .nav-tab.active {
                background: white;
                border-bottom: 3px solid rgb(42, 51, 183);
                font-weight: bold;
            }

            .tab-content {
                padding: 30px;
            }
            
            .tab-pane {
                display: none;
            }

            .tab-pane.active {
                display: block;
            }

            .stats-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 20px;
                margin-bottom: 30px;
            }

            .stat-card {
                background: linear-gradient(135deg, rgb(220, 223, 236) 0%,rgb(42, 51, 183) 100%);
                color: white;
                padding: 25px;
                border-radius: 10px;
                text-align: center;
            }

            .stat-number {
                font-size: 2.5em;
                font-weight: bold;
                margin-bottom: 5px;
            }

            .stat-label {
                font-size: 1.1em;
                opacity: 0.9;
            }

            .form-group {
                margin-bottom: 20px;
            }

            .form-group label {
                display: block;
                margin-bottom: 5px;
                font-weight: bold;
                color: #333;
            }

            .form-group input,
            .form-group select {
                width: 100%;
                padding: 12px;
                border: 2px solid #e1e5e9;
                border-radius: 8px;
                font-size: 16px;
                transition: border-color 0.3s;
            }

            .form-group input:focus,
            .form-group select:focus {
                outline: none;
                border-color: #667eea;
            }

            .btn {
                background: linear-gradient(135deg, rgb(220, 223, 236) 0%,rgb(42, 51, 183) 100%);
                color: white;
                border: none;
                padding: 12px 25px;
                border-radius: 8px;
                cursor: pointer;
                font-size: 16px;
                transition: transform 0.2s;
            }

            .btn:hover {
                transform: translateY(-2px);
            }

            .btn-danger {
                background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            }

            .btn-success {
                background: linear-gradient(135deg, #2ed573 0%, #1e90ff 100%)
            }

            .table-container {
                overflow-x: auto;
                margin-top: 20px;
            }

            table {
                width: 100%;
                border-collapse: collapse;
                background: white;
                border-radius: 10px;
                overflow: hidden;
                box-shadow: 0 5px 15px rgba(0,0,0,0.1)
            }

            th, td {
                padding: 15px;
                text-align: left;
                border-bottom: 1px solid #e1e5e9;
            }

            th {
                background: #f8f9fa;
                font-weight: bold;
                color: #333;
            }

            tr:hover {
                background: #f8f9fa
            }

            .low-stock {
                background: #fff3cd;
                color: #856404;
                padding: 5px 10px;
                border-radius: 5px;
                font-size: 0.9em;
            }

            .stock-controls {
                display: flex;
                gap: 10px;
                align-items: center;
            }
            
            .stock-input {
                width: 80px;
                padding: 5px;
                border: 1px solid #ddd;
                border-radius: 4px;
            }
            
            .alert {
                padding: 15px;
                border-radius: 8px;
                margin-bottom: 20px;
            }
            
            .alert-success {
                background: #d4edda;
                color: #155724;
                border: 1px solid #c3e6cb;
            }
            
            .alert-error {
                background: #f8d7da;
                color: #721c24;
                border: 1px solid #f5c6cb;
            }

        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>Beer Inventory System</h1>
            </div>
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showTab('dashboard')">Dashboard</button>
                <button class="nav-tab" onclick="showTab('products')">Products</button>
                <button class="nav-tab" onclick="showTab('brands')">Brands</button>
                <button class="nav-tab" onclick="showTab('stock')">Stock Management</button>
            </div>

            <div class="tab-content">
                <!-- Dashboard Tab -->
                <div id="dashboard" class="tab-pane active">
                    <h2>Inventory Overview</h2>
                    <div class="stats-grid" id="statsGrid">
                        <!-- Stats will load here -->
                    </div>

                    <h3>Low Stock Items</h3>
                    <div class="table-container">
                        <table id="lowStockTable">
                            <thead>
                                <tr>
                                    <th>Product</th>
                                    <th>Brand</th>
                                    <th>Current Stock</th>
                                    <th>Price</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Low stock items will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Products Tab -->
                <div id="products" class="tab-pane">
                    <h2>Product Management</h2>
                    <div class="form-group">
                        <button class="btn" onclick="showAddProductForm()">Add New Product</button>
                    </div>

                    <!-- Add Product Form -->
                    <div id="addProductForm" style="display: none; background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom:20px;">
                        <h3>Add New Product</h3>
                        <form id="productForm">
                            <div class="form-group">
                                <label>Product Name:</label>
                                <input type="text" id="productName" required>
                            </div>
                            <div class="form-group">
                                <label>SKU:</label>
                                <input type="text" id="productSku" required>
                            </div>
                            <div class="form-group">
                                <label>Brand:</label>
                                <select id="productBrand" required>
                                    <!-- Brands will be loaded here -->
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Package Size:</label>
                                <input type="text" id="productPackageSize" placeholder="e.g., 12 Pack">
                            </div>
                            <div class="form-group">
                                <label>Price:</label>
                                <input type="number" id="productPrice" step="0.01" required>
                            </div>
                            <div class="form-group">
                                <label>Type:</label>
                                <input type="text" id="productType" placeholder="e.g., Lager, Stout">
                            </div>
                            <div class="form-group">
                                <label>ABV (%):</label>
                                <input type="number" id="productAbv" step="0.1" placeholder="e.g., 5.0">
                            </div>
                            <div class="form-group">
                                <label>Initial Stock:</label>
                                <input type="number" id="productStock" required>
                            </div>
                            <button type="submit" class="btn">Save Product</button>
                            <button type="button" class="btn btn-danger" onclick="hideAddProductForm()">Cancel</button>
                        </form>
                    </div>

                    <div class="table-container">
                        <table id="productsTable">
                            <thead>
                                <tr>
                                    <th>Product</th>
                                    <th>SKU</th>
                                    <th>Brand</th>
                                    <th>Package</th>
                                    <th>Price</th>
                                    <th>Type</th>
                                    <th>ABV</th>
                                    <th>Stock</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Products will load here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Brands Tab -->
                <div id="brands" class="tab-pane">
                    <h2>Brand Management</h2>
                    
                    <div class="form-group">
                        <button class="btn" onclick="showAddBrandForm()">Add New Brand</button>
                    </div>
                    
                    <!-- Add Brand Form -->
                    <div id="addBrandForm" style="display: none; background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h3>Add New Brand</h3>
                        <form id="brandForm">
                            <div class="form-group">
                                <label>Brand Name:</label>
                                <input type="text" id="brandName" required>
                            </div>
                            <div class="form-group">
                                <label>Country:</label>
                                <input type="text" id="brandCountry" required>
                            </div>
                            <div class="form-group">
                                <label>Description:</label>
                                <input type="text" id="brandDescription" placeholder="Brief description of the brand">
                            </div>
                            <button type="submit" class="btn">Save Brand</button>
                            <button type="button" class="btn btn-danger" onclick="hideAddBrandForm()">Cancel</button>
                        </form>
                    </div>
                    
                    <div class="table-container">
                        <table id="brandsTable">
                            <thead>
                                <tr>
                                    <th>Brand Name</th>
                                    <th>Country</th>
                                    <th>Description</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Brands will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Stock Management Tab -->
                <div id="stock" class="tab-pane">
                    <h2>Stock Management</h2>
                    <div class="table-container">
                        <table id="stockTable">
                            <thead>
                                <tr>
                                    <th>Product</th>
                                    <th>Brand</th>
                                    <th>Current Stock</th>
                                    <th>Price</th>
                                    <th>Stock Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Stock management will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <script>
            //const API_BASE = 'http://localhost:5000/api';
            const API_BASE = 'http://127.0.0.1:5500/api'

            // Tab switching
            function showTab(tabName) {
                // Hide all tab panes
                document.querySelectorAll('.tab-pane').forEach(pane => {
                    pane.classList.remove('active');
                });

                // Remove active class from all tabs
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.classList.remove('active')
                })

                // Show selected tab pane
                document.getElementById(tabName).classList.add('active')

                // Add active class to clicked tab
                event.target.classList.add('active')

                // Load data for the tab
                if (tabName === 'dashboard') {
                    loadDashboard();
                } else if (tabName === 'products') {
                    loadProducts()
                    loadBrandsForSelect()
                } else if (tabName === 'brands') {
                    loadBrands()
                } else if (tabName === 'stock') {
                    loadStockManagement()
                }
            }

            // Dashboard functions
            async function loadDashboard() {
                try {
                    const [summaryResponse, lowStockResponse] = await Promise.all([
                        fetch(`${API_BASE}/inventory/summary`),
                        fetch(`${API_BASE}/products/low-stock`)
                    ])

                    const summary = await summaryResponse.json()
                    const lowStockItems = await lowStockResponse.json()

                    // Update stats
                    document.getElementById('statsGrid').innerHTML = `
                        <div class="stat-card">
                            <div class="stat-number">${summary.total_products}</div>
                            <div class="stat-label">Total Products</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${summary.total_brands}</div>
                            <div class="stat-label">Total Brands</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${summary.total_stock_value}</div>
                            <div class="stat-label">Total Stock Value</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${summary.low_stock_items}</div>
                            <div class="stat-label">Low Stock Items</div>
                        </div>
                    `

                    // Update low stock table
                    const lowStockTableBody = document.querySelector('#lowStockTable tbody')
                    lowStockTableBody.innerHTML = lowStockItems.map(item => `
                        <tr>
                            <td>${item.name}</td>
                            <td>${item.brand?.name || 'N/A'}</td>
                            <td><span class="low-stock">${item.stock}</span></td>
                            <td>$${item.price}</td>
                        </tr>
                    `).join('')
                } catch (error) {
                    console.error('Error loading dashboard:', error)
                }
            }

            // Product functions
            async function loadProducts() {
                try {
                    const response = await fetch(`${API_BASE}/products`)
                    const products = await response.json()

                    const tableBody = document.querySelector('#productsTable tbody')
                    tableBody.innerHTML = products.map(product => `
                        <tr>
                            <td>${product.name}</td>
                            <td>${product.sku}</td>
                            <td>${product.brand?.name || 'N/A'}</td>
                            <td>${product.package_size}</td>
                            <td>${product.price}</td>
                            <td>${product.type}</td>
                            <td>${product.abv}</td>
                            <td>${product.stock < 10 ? `<span class="low-stock">${product.stock}</span>` : product.stock}</td>
                            <td>
                                <button class="btn btn-danger" onclick="deleteProduct(${product.id})">Delete</button>
                            </td>
                        </tr>
                    `).join('')
                } catch (error) {
                    console.error('Error loading products:', error)
                }
            }

            async function loadBrandsForSelect() {
                try {
                    const response = await fetch(`${API_BASE}/brands`)
                    const brands = await response.json()

                    const select = document.getElementById('productBrand')
                    select.innerHTML = brands.map(brand => 
                        `<option value="${brand.id}">${brand.name}</option>`
                    ).join('')
                } catch (error) {
                    console.error('Error loading brands:', error)
                }
            }

            function showAddProductForm() {
                document.getElementById('addProductForm').style.display = 'block'
            }

            function hideAddProductForm() {
                document.getElementById('addProductForm').style.display = 'none'
                document.getElementById('productForm').reset()
            }

            document.getElementById('productForm').addEventListener('submit', async (e) => {
                e.preventDefault()

                const productData = {
                    name: document.getElementById('productName').value,
                    sku: document.getElementById('productSku').value,
                    brand_id: parseInt(document.getElementById('productBrand').value),
                    package_size: document.getElementById('productPackageSize').value,
                    price: parseFloat(document.getElementById('productPrice').value),
                    type: document.getElementById('productType').value,
                    abv: parseFloat(document.getElementById('productAbv').value) || 0,
                    stock: parseInt(document.getElementById('productStock').value)
                }

                try {
                    const response = await fetch(`${API_BASE}/products`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(productData)
                    })

                    if (response.ok) {
                        alert('product added successfully!')
                        hideAddProductForm()
                        loadProducts()
                        loadDashboard()
                    } else {
                        const error = await response.json()
                        alert('Error: ' + error.error)
                    }
                } catch (error) {
                    console.error('Error adding product:', error)
                    alert('Error adding product')
                }
            })

            async function deleteProduct(productId) {
                if (confirm('Are you sure you want to delete this product?')) {
                    try {
                        const response = await fetch(`${API_BASE}/products/${productId}`, {
                            method: 'DELETE'
                        })

                        if (response.ok) {
                            alert('Product deleted successfully!')
                            loadProducts()
                            loadDashboard()
                        } else {
                            const error = await response.json()
                            alert('Error: ' + error.error)
                        }
                    } catch (error) {
                        console.error('Error deleteing product:', error)
                    }
                }
            }

            // Brand functions
            async function loadBrands() {
                try {
                    const response = await fetch(`${API_BASE}/brands`)
                    const brands = await response.json()

                    const tableBody = document.querySelector('#brandsTable tbody')
                    tableBody.innerHTML = brands.map(brand => `
                        <tr>
                            <td>${brand.name}</td>
                            <td>${brand.country}</td>
                            <td>${brand.description}</td>
                            <td>
                                <button class="btn btn-danger" onclick="deleteBrand(${brand.id})">Delete</button>
                            </td>
                        </tr>
                    `).join('')
                } catch (error) {
                    console.error('Error loading brands:', error)
                }
            }

            function showAddBrandForm() {
                document.getElementById('addBrandForm').style.display = 'block';
            }
            
            function hideAddBrandForm() {
                document.getElementById('addBrandForm').style.display = 'none';
                document.getElementById('brandForm').reset();
            }

            document.getElementById('brandForm').addEventListener('submit', async (e) => {
                e.preventDefault()

                const brandData = {
                    name:document.getElementById('brandName').value,
                    country: document.getElementById('brandCountry').value,
                    description: document.getElementById('brandDescription').value
                }

                try {
                    const response = await fetch(`${API_BASE}/brands`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(brandData)
                    })

                    if (response.ok) {
                        alert('Brand added successfully!')
                        hideAddBrandForm()
                        loadBrands()
                        loadDashboard()
                    } else {
                        const error = await response.json()
                        alert('Error: ' + error.error)
                    }
                } catch (error) {
                    console.error('Error adding brand', error)
                    alert('Error adding brand')
                }
            })

            async function deleteBrand(brandId) {
                if (confirm('Are you sure you want to delete this brand?')) {
                    try {
                        const response = await fetch(`${API_BASE}/brands/${brandId}`, {
                            method: 'DELETE'
                        });
                        
                        if (response.ok) {
                            alert('Brand deleted successfully!');
                            loadBrands();
                            loadDashboard();
                        } else {
                            const error = await response.json();
                            alert('Error: ' + error.error);
                        }
                    } catch (error) {
                        console.error('Error deleting brand:', error);
                        alert('Error deleting brand');
                    }
                }
            }

            // Stock management functions
            async function loadStockManagement() {
                try {
                    const response = await fetch(`${API_BASE}/products`);
                    const products = await response.json();
                    
                    const tableBody = document.querySelector('#stockTable tbody');
                    tableBody.innerHTML = products.map(product => `
                        <tr>
                            <td>${product.name}</td>
                            <td>${product.brand?.name || 'N/A'}</td>
                            <td>${product.stock < 10 ? `<span class="low-stock">${product.stock}</span>` : product.stock}</td>
                            <td>$${product.price}</td>
                            <td class="stock-controls">
                                <input type="number" class="stock-input" id="stockInput${product.id}" placeholder="Qty" min="1">
                                <button class="btn btn-success" onclick="adjustStock(${product.id}, 'add')">Add</button>
                                <button class="btn btn-danger" onclick="adjustStock(${product.id}, 'subtract')">Remove</button>
                            </td>
                        </tr>
                    `).join('');
                } catch (error) {
                    console.error('Error loading stock management:', error);
                }
            }
            
            async function adjustStock(productId, action) {
                const amountInput = document.getElementById(`stockInput${productId}`);
                const amount = parseInt(amountInput.value);
                
                if (!amount || amount <= 0) {
                    alert('Please enter a valid amount');
                    return;
                }
                
                try {
                    const response = await fetch(`${API_BASE}/products/${productId}/adjust-stock`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            amount: amount,
                            action: action
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (response.ok) {
                        alert(`Stock ${action}ed successfully! New stock: ${result.new_stock}`);
                        amountInput.value = '';
                        loadStockManagement();
                        loadDashboard();
                    } else {
                        alert('Error: ' + result.error);
                    }
                } catch (error) {
                    console.error('Error adjusting stock:', error);
                    alert('Error adjusting stock');
                }
            }

            // Initialize dashboard on page load
            window.onload = function() {
                loadDashboard()
            }
        </script>
    </body>
</html>